# Shakugenerator User Guide

## How to install:

Install dependencies with poetry:

```bash
poetry install
```

Use invoke rule to run program by command:

```bash
poetry run invoke start
```

## How to use:

At the start, the user will be prompted with two questions in the terminal:

First:

```
Choose type of output
(1 = wav, 2 = csv, 3 = midi 0 = quit) :
```

To choose the type of output, type a single digit as adviced.

Then:

```How many measures should be generated? (0 to quit)```

Type any positive integer, corresponding to the lenght of the generated music. The lenght is measured in musical measures. The lenght of a single measure and the tempo of the music can be configured in the .env -file as adviced below in section "How to configure"

After the user has correctly answered (and not inputted 0 for quit) for the above questions, output is produced in the requested format. The terminal will also display a list of the note pitches and lenghts that were produced. 

If the user chose csv as the required output format, a csv file will be written, where each note representation consists of a pitch integer and lenght integer separated by a regular comma, and the note representations are separated by a semicolon.

If the user chose midi or wav format, the corresponding file is created, from which the music can be played. (Most computers can play wav files, but for midi playback additional applications might need to be installed / configured)

## How to configure

The root folder includes the file ".env" (which might appear hidden in some file explorers due to the leading dot)

The aforementioned file contains a list of environment variables definitions used by the application. Varibles regarding pitches, note lenghts and measure lenghts might not behave exactly as you expect depending on your musical knowledge and interpretation of the variable meanings. In case you change the variables and the application does not behave as expected, you can revert the changes by restoring the repository into its original state.

Here is a list of configuration changes you might wish to change:

SHAKUGEN_MIDI_INSTRUMENT_NUMBER is a variable that governs what midi instrument will be used in the output. 73 is the midi number for shakuhachi, but you may wish to hear the output with different generated instrument sounds. Consult any list for midi instrument numbers for reference.

SHAKUGEN_TEMPO and SHAKUGEN_VOLUME correspond to the tempo (speed) and volume of the output.

Editing SHAKUGEN_LOWEST_PITCH and SHAKUGEN_HIGHEST_PITCH is not recommended as they are primarily used for development purposes and editing them may break the repositorys test cases - and not be compatible with the provided training files. If you wish to change the output to a higher or lower pitch, you may use the RO_DAIMERI_PITCH -variable (see below for explanation)

Editing SHAKUGEN_LENGHTS is also not recommended. It may produce different kinds of output in terms of rhytm dynamics, but it may also break the program. The default lenghts configured are compatible with the provided training data.

SHAKUGEN_TRAINING_FILES is a variable pointing to the training files used by the program. In the current version the trie tree is populated with note sequences parsed from files pointed by this variable. This training happens at the start of running the program, every time. For scalability, future versions (outside the university course, for personal use) of the program may be configured so that trained tree structures are cached for future use and only ever re-trained when a change in this variable or in the files pointed by it is detected.
  The training files accepted by the program are ".shaku" -files, which are generated with the ShakuNotator program. 

SHAKUGEN_TMP_MIDI_FILE and SHAKUGEN_TMP_WAV_FILE point the name of the output files to be generated by the program. Please note that as this variable is not changed dynamically, the files will always be overwritten on sequential runs of the program, if not copied somewhere else, or renamed.

RO_DAIMERI_PITCH is a variable pointing to the pitch of the base note of shakuhachi as a midi integer. For a default shakuhachi of 1.8 lenght, the base pitch is 62. However, this number can be edited lower for lower pitched output, and higher for higher pitched output.

LENGHT_REP_STOP_WEIGHT and PITCH_REP_STOP_WEIGHT are variables denoting how many times in a row may the program generate the same note lenght and pitch, respectively. This prevents the program looping a sequence of repeats of the same note pitch or lenght for longer than the given integer number of times. (to prevent the algorithm from looping a continuous sequence of the same note, which is a distinct possibility with Markov tree algorithms)

## About separation of pitch and lenght generation

The program generates pitch and lenght integers independently, both respectively based on sequences of pitches and lenghts in the training data. It could arguably produce music with a higher likeness to the training data, if it were to consider the note+pitch as a combination. This would be trivially easy to implement - but would require a larger amount of training data. As the intended plug-in usage of the application is intended to impose further rhytm and harmonics restrictions, the amount of training data would need to be very significant for this - and it would provide close to no value as the intended usage is not independent creation of music with likeness to the training data. This restriction would also expose the program to a higher likelihood of overfitting without a more careful selection of the training data.
